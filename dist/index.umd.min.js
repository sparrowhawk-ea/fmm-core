!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).sayHello={})}(this,(function(t){"use strict";class e{constructor(){this.minimaps=new Set}notifyMinimapOnUpdate(t,e){e?this.minimaps.add(t):this.minimaps.delete(t)}notifyMinimaps(){const t=new Set;this.minimaps.forEach((e=>e.takeSnapshot()||t.add(e))),t.forEach((t=>this.minimaps.delete(t)))}}class i{constructor(t,e){this.e=t,this.key=e}destructor(){}}const s={createFrameworkItem:(t,e)=>"INPUT"===e.tagName&&["checkbox","radio"].includes(e.type)?l.B4_Check:l.B4_Other};class n{constructor(t,e){this.form=t,this.resizeObserver=new ResizeObserver(this.onFormResize.bind(this)),this.page=e||t,this.resizeObserver.observe(t),this.updateLayoutOnScroll=this.updateLayoutOnScroll.bind(this),this.page.addEventListener("scroll",this.updateLayoutOnScroll,!0)}clearLayoutHandler(){this.resizeObserver.disconnect(),this.page.removeEventListener("scroll",this.updateLayoutOnScroll,!0),this.layoutHandler=void 0}clipsContentX(t){const{overflow:e,overflowX:i}=t.style;return n.CLIP.includes(e)||n.CLIP.includes(i)}clipsContentY(t){const{overflow:e,overflowY:i}=t.style;return n.CLIP.includes(e)||n.CLIP.includes(i)}getDisplayLabel(t,e){return(null==e?void 0:e.getAttribute("aria-label"))||(null==e?void 0:e.textContent)||t.getAttribute("aria-label")||t.id}getDisplayValue(t,e,i){const s=t.tagName;if("INPUT"===s){const s=t;return"checkbox"===s.type||"radio"===s.type?s.checked?e:"":"password"===s.type?"*****":String(i)}if("SELECT"===s){const e=Array.isArray(i)?i:[i];if(!e.length)return String(i);const s=t.options;if("number"==typeof e[0])return e.map((t=>s[t].text)).join("\n");return Array.from(s).filter((t=>e.includes(t.value))).map((t=>t.text)).join("\n")}return String(i)}getElements(t){const e=Array.from(this.form.elements);return t.length&&e.push(...Array.from(this.page.querySelectorAll("#"+t.join(",#")))),e}getLabelFor(t){var e,i;let s=t.id?this.page.querySelector("label[for="+t.id+"]"):void 0;return s||"LABEL"!==(null===(e=t.parentElement)||void 0===e?void 0:e.tagName)||(s=t.parentElement),s||"LABEL"!==(null===(i=t.previousElementSibling)||void 0===i?void 0:i.tagName)||(s=t.previousElementSibling),s}getParent(t){return t.parentElement}getPlaceholder(t){return t.getAttribute("placeholder")||""}getRect(t){return(t||this.page).getBoundingClientRect()}getStoreKeys(t){const e=t.getAttribute("name");return e?[e,t.id]:[t.id]}isDisabled(t){if("TEXTAREA"!==t.tagName)return t.disabled;const e=t;return e.disabled||e.readOnly}isHidden(t){return t.hidden}setLayoutHandler(t){this.layoutHandler=t}onFormResize(){this.layoutHandler&&this.layoutHandler.handleLayout()}updateLayoutOnScroll(t){t.target instanceof HTMLElement&&this.layoutHandler&&this.layoutHandler.handleLayout(t.target)}}n.CLIP=["auto","hidden","scroll"];class a{constructor(t){if(this.wrapperClass=t,!t)throw new Error("FmmFrameworkItemBase requires wrapperClass")}destructor(){}getEnvelope(t,e,i){let s=e.parentElement;for(;s&&"FORM"!==s.tagName&&!s.classList.contains(this.wrapperClass);)s=s.parentElement;if(s&&"FORM"!==s.tagName)return s;if(i){for(s=i.parentElement;s&&"FORM"!==s.tagName&&!s.classList.contains(this.wrapperClass);)s=s.parentElement;return s&&"FORM"!==s.tagName?s:void 0}}getError(t,e,i,s){return""}getLabel(t,e){return e.querySelector("LABEL")||e.querySelector("[aria-label]")}getValue(t,e,i,s){return""}}class o extends e{constructor(){super(...arguments),this.listener=this.notifyMinimaps.bind(this)}createStoreItem(t,e){const i=e.tagName;if("INPUT"===i){const t=e;return o.INPUTTYPES.includes(t.type)?new d(t,this.listener):void 0}return"SELECT"===i?new p(e,this.listener):"TEXTAREA"===i?new c(e,this.listener):void 0}getError(t,e,i){return e.fe.validationMessage||e.fe.required&&!e.fe.value&&"Required"||""}getName(t,e){return e.fe.name}getValue(t,e){return e.getValue()}isDisabled(t,e){return t.isDisabled(e.fe)}}o.INPUTTYPES=["checkbox","color","date","datetime","datetime-local","email","month","number","password","radio","range","search","tel","text","time","url","week"];class r extends a{constructor(t){super(t)}getError(t,e,i,s){if(!e.classList.contains("is-invalid"))return"";for(let t=e.nextElementSibling;t&&t!==e;t=t.nextElementSibling)if(t.classList.contains("invalid-feedback"))return t.textContent||"";return""}}const l={B4_Check:new r("form-check"),B4_Other:new r("form-group")};class h{constructor(t,e,i){this.fe=t,this.event=e,this.listener=i,t.addEventListener(e,i)}destructor(){this.fe.removeEventListener(this.event,this.listener)}getValue(){return this.fe.value||void 0}isDisabled(){return this.fe.disabled}}class d extends h{constructor(t,e){super(t,"input",e)}}class p extends h{constructor(t,e){super(t,"change",e),this.e=t,this.isMultiple=t.multiple}getValue(){const t=this.e.selectedIndex;if(t<0)return;if(!this.isMultiple)return[t];const e=[],i=this.e.options;for(let s=i.length;--s>=t;)i[s].selected&&e.push(s);return e.reverse()}}class c extends h{constructor(t,e){super(t,"input",e),this.e=t}}class m{static createMinimap(t,e,i){if(e){return new E(i||b.EF,!0,e).createMinimap(Object.assign(Object.assign({},t),{anchor:void 0,usePanelDetail:!0}))}if(!t.anchor)throw new Error("FmmMinimap not created: invalid anchor");return new E(i||b.EF,!1).createMinimap(Object.assign(Object.assign({},t),{usePanelDetail:!1}))}static createPanel(t,e,i,s){if(!t)throw new Error("FmmPanel not created: invalid parent");return new E(s||b.EF,!!i,t,e)}static trim(t){return null==t?void 0:t.trim().replace(/\u200B/g,"")}}m.CLASS=Object.freeze({Detached:"fmm-detached",DetailPopup:"fmm-detail",Disabled:"fmm-disabled",Error:"fmm-error",Fieldset:"fmm-fieldset",Header:"fmm-header",Invalid:"fmm-invalid",Legend:"fmm-legend",MinimapFrame:"fmm-frame",MinimapPopup:"fmm-popup",Optional:"fmm-optional",Pushpin:"fmm-pushpin",Required:"fmm-required",Title:"fmm-title",Valid:"fmm-valid",Value:"fmm-value"}),m.CSS="\n\tcircle.fmm-pushpin {\n\t\tfill: blue;\n\t}\n\tdiv.fmm-detail,\n\tdiv.fmm-popup {\n\t\tbackground-color: darkgray;\n\t\tborder: 1px solid black;\n\t\tbox-shadow: 5px 5px lightgray;\n\t\tpadding-top: 10px;\n\t\tz-index: 1;\n\t}\n\tdiv.fmm-disabled {\n\t\tbackground-color: darkgray;\n\t}\n\tdiv.fmm-disabled,\n\tdiv.fmm-invalid,\n\tdiv.fmm-optional,\n\tdiv.fmm-required,\n\tdiv.fmm-valid {\n\t\tborder: 1px solid transparent;\n\t}\n\tdiv.fmm-frame {\n\t\tbackground-color: white;\n\t}\n\tdiv.fmm-header {\n\t\tborder-bottom: 5px groove;\n\t\tmargin: 0;\n\t}\n\tdiv.fmm-invalid {\n\t\tbackground-color: red;\n\t}\n\tdiv.fmm-optional {\n\t\tborder-color: black;\n\t}\n\tdiv.fmm-required {\n\t\tborder-color: red;\n\t}\n\tdiv.fmm-valid {\n\t\tbackground-color: green;\n\t}\n\tfieldset.fmm-fieldset {\n\t\tbackground-color: white;\n\t\tborder-top: 5px groove;\n\t\tmin-width: 0;\n\t\tpadding: 5px 10px;\n\t}\n\tfieldset.fmm-fieldset div.fmm-disabled,\n\tfieldset.fmm-fieldset div.fmm-invalid,\n\tfieldset.fmm-fieldset div.fmm-optional,\n\tfieldset.fmm-fieldset div.fmm-required,\n\tfieldset.fmm-fieldset div.fmm-valid {\n\t\tborder-width: 2px;\n\t}\n\tlabel.fmm-title {\n\t\tfont-size: smaller;\n\t\tpadding: 2px;\n\t}\n\tlegend.fmm-legend {\n\t\tbackground-color: white;\n\t\tmargin: 5px;\n\t\tmax-width: 100%;\n\t\tpadding-right: 5px;\n\t}\n\ttextarea.fmm-value {\n\t\theight: 3em;\n\t\twidth: 100%;\n\t}\n\tdiv.fmm-detached.fmm-popup,\n\tdiv.fmm-detached div.fmm-detail {\n\t\tbackground-color: lightgray;\n\t}\n\tdiv.fmm-detached.fmm-frame,\n\tdiv.fmm-detached div.fmm-frame,\n\tdiv.fmm-detached fieldset.fmm-fieldset,\n\tiv.fmm-detached legend.fmm-legend {\n\t\tbackground-color: lightgray !important;\n\t}\n\t",m.STATUS_CLASS=Object.freeze({Disabled:"fmm-disabled",Invalid:"fmm-invalid",Optional:"fmm-optional",Required:"fmm-required",Valid:"fmm-valid"});class u{constructor(t,e,i){this.parent=i,this.clip=(null==i?void 0:i.clipRect(t.getRect(e)))||t.getRect(e),this.clipX=t.clipsContentX(e),this.clipY=t.clipsContentY(e)}clipRect(t){const e=Math.max(t.left,this.clip.left),i=Math.max(t.top,this.clip.top),s=Math.max(0,(this.clipX?Math.min(t.right,this.clip.right):t.right)-e),n=Math.max(0,(this.clipY?Math.min(t.bottom,this.clip.bottom):t.bottom)-i),a={left:e,top:i,width:s,height:n,right:e+s,bottom:i+n};return s&&n&&this.parent?this.parent.clipRect(a):a}}class g{constructor(t,e){this.debounceMsec=t,this.task=e,this._doTask=this.doTask.bind(this),this.notBeforeMsec=0}destructor(){this.task&&(this.timer&&window.clearTimeout(this.timer),this.timer=void 0)}cancel(){return!!this.timer&&(window.clearTimeout(this.timer),this.timer=void 0,!0)}doNow(){this.task&&(this.cancel(),this.task())}schedule(){this.task&&(this.notBeforeMsec=Date.now()+this.debounceMsec,this.timer||(this.timer=window.setTimeout(this._doTask,this.debounceMsec)))}doTask(){const t=this.notBeforeMsec-Date.now();t>0?this.timer=window.setTimeout(this._doTask,t):(this.timer=void 0,this.task())}}class f{constructor(t,e){this.data=L.NULLDATA,this.minimapId=0;const i=this.e=t.createElement("FIELDSET");i.className=m.CLASS.Fieldset;const s=b.ELLIPSIS(t.createElement("LEGEND"));s.className=m.CLASS.Legend,this.status=s.appendChild(t.createElement("DIV")),this.status.style.display="inline-block",this.status.style.margin="3px 6px 0 3px",this.status.style.height="0.7em",this.status.style.width="1em",this.label=s.appendChild(t.createElement("SPAN")),this.label.textContent=b.NBSP,i.appendChild(s),this.value=i.appendChild(t.createElement("TEXTAREA")),this.value.className=m.CLASS.Value,this.value.readOnly=!0,this.error=b.ELLIPSIS(i.appendChild(t.createElement("DIV"))),this.error.className=m.CLASS.Error,this.error.textContent=b.NBSP,e&&e.appendChild(i)}destructor(){this.e.parentElement&&this.e.parentElement.removeChild(this.e)}clear(t){t&&t!==this.data||(this.error.textContent=this.label.textContent=b.NBSP,this.status.className=this.value.placeholder=this.value.value="",this.data=L.NULLDATA)}refreshDisplay(t){var e,i;if(t!==this.minimapId)return;const s=this.data,n=(null===(e=s.aggregateLabel)||void 0===e?void 0:e.concat(": "))||"";this.error.textContent=this.error.title=s.error||b.NBSP,this.label.textContent=this.label.title=n+s.label||b.NBSP,this.status.className=m.STATUS_CLASS[s.status],this.value.placeholder=s.placeholder||"",this.value.value=(null===(i=s.aggregateValues)||void 0===i?void 0:i.join("\n"))||s.value||""}setDisplay(t,e){this.data=e||L.NULLDATA,this.refreshDisplay(this.minimapId=t)}}class v{constructor(t,e,i,s){var n;this.e=e,this.storeItem=i;const a=s.form.getLabelFor(e);this.dynamicLabel=s.dynamicLabels.includes(t),this.form=s.form,this.framework=(null===(n=s.framework)||void 0===n?void 0:n.createFrameworkItem(t,e))||v.DEFAULT_FRAMEWORK,this.envelope=this.framework.getEnvelope(t,e,a)||this.getCommonAncestor(e,a)||e,this.label=a||this.framework.getLabel(t,this.envelope),this.snapshot=new L(t,s)}destructor(){this.framework.destructor(),this.storeItem.destructor()}layoutSnapshot(t,e,i){const s=this.form.getParent(this.envelope);if(!s)return this.snapshot.setRect();const n=(t.get(s)||this.getClipContext(s,t)).clipRect(this.form.getRect(this.envelope));if(!n.width||!n.height)return this.snapshot.setRect();const a=Math.floor((n.left-e.left)*i),o=Math.floor((n.top-e.top)*i),r=Math.max(2,Math.floor(n.height*i)),l=Math.max(2,Math.floor(n.width*i));return this.snapshot.setRect(new DOMRectReadOnly(a,o,l,r))}removeIfDetached(){if(this.form.getParent(this.envelope))for(let t=this.e;t;t=this.form.getParent(t))if(t===this.envelope)return!1;return this.snapshot.destructor(),this.destructor(),!0}takeSnapshot(t,e){const i=this.snapshot.data,s=i.name;(void 0===i.label||this.dynamicLabel)&&(i.label=m.trim(t.getDisplayLabel(this.e,this.label)||s),i.placeholder=m.trim(this.form.getPlaceholder(this.e)));let n=m.trim(this.framework.getValue(s,this.e,this.envelope,i.label));if(!n){const s=e.getValue(t,this.storeItem);s&&(n=m.trim(t.getDisplayValue(this.e,i.label,s)))}i.value=n;const a=!!n;return a&&i.aggregateValues&&i.aggregateValues.push(n),i.error=m.trim(this.framework.getError(s,this.e,this.envelope,a)||e.getError(t,this.storeItem,a)),e.isDisabled(t,this.storeItem)?this.snapshot.setStatus("Disabled"):a?this.snapshot.setStatus(i.error?"Invalid":"Valid"):this.snapshot.setStatus(i.error?"Required":"Optional"),i}getClipContext(t,e){const i=this.form.getParent(t),s=i?e.get(i)||this.getClipContext(i,e):void 0,n=new u(this.form,t,s);return e.set(t,n),n}getCommonAncestor(t,e){const i=[];for(;e;e=this.form.getParent(e))i.push(e);for(;t&&!i.includes(t);)t=this.form.getParent(t);return t}}v.DEFAULT_FRAMEWORK={destructor:()=>{},getEnvelope:(t,e,i)=>{},getError:(t,e,i,s)=>"",getLabel:(t,e)=>{},getValue:(t,e,i,s)=>""};class S{constructor(){this.list=[],this.ignore=new WeakSet,this.nameCounter=0}destructor(){this.ignore=new WeakSet,this.list.splice(0).forEach((t=>t.destructor()))}compose(t){const e=t.form.getElements(t.customElementIds);this.list.splice(0).forEach((t=>t.removeIfDetached()||this.list.push(t)));const i=new WeakSet;this.list.forEach((t=>i.add(t.e))),e.forEach((e=>{if(i.has(e)||this.ignore.has(e))return;if(t.form.isHidden(e))return this.ignore.add(e);const s=t.store.createStoreItem(t.form,e);if(s){const i=t.store.getName(t.form,s)||S.NAMEPREFIX+String(this.nameCounter++);this.list.push(new v(i,e,s,t))}i.add(e)}))}layoutSnapshots(t,e,i){this.list.forEach((s=>s.layoutSnapshot(t,e,i)))}takeSnapshots(t,e){return this.list.map((i=>i.takeSnapshot(t,e)))}}S.NAMEPREFIX="$FmmFSI";class y{constructor(t,e,i,s){this.dragData="";const n=this.div=t.createElement("DIV");n.className=m.CLASS.MinimapFrame,n.draggable=!0,n.ondragstart=this.onDragStart.bind(this),n.style.cursor="grab",n.style.position="relative";const a=this.header=n.appendChild(t.createElement("DIV"));a.className=m.CLASS.Header,a.style.overflow="hidden",a.style.whiteSpace="nowrap";const o=b.ELLIPSIS(t.createElement("LABEL"));o.className=m.CLASS.Title,o.style.cursor="inherit",o.textContent=o.title=i;const r=e.style;if(s){r.position="absolute",r.top=r.bottom=r.left=r.right="0",y.POSITIONS.includes(s.style.position)||(s.style.position="relative"),s.appendChild(e),this.popup=new C(t,m.CLASS.MinimapPopup,this.div,e);let i=e.previousElementSibling;for(;i&&!i.className.includes("fmm-");)i=i.previousElementSibling;i&&s.removeChild(i),this.setDestroyOnDetachFromDOM(s,e)}else a.appendChild(e),r.display="inline-block",r.margin="1px 2px 0 1px",r.height="0.5em",r.width="0.8em";a.appendChild(o)}destructor(){var t;this.div.parentElement&&(this.detach(),this.popup&&this.popup.destructor(),this.popup=void 0,this.div.onmouseenter=this.div.onmouseleave=null,null===(t=this.div.parentElement)||void 0===t||t.removeChild(this.div))}detach(){var t;this.popup?null===(t=this.div.parentElement)||void 0===t||t.classList.add(m.CLASS.Detached):this.div.classList.add(m.CLASS.Detached)}newDetailPopup(t,e){return new C(t,m.CLASS.DetailPopup,e.e,this.div)}setSnapshotResult(t){this.dragData=JSON.stringify(t)}onDragStart(t){var e;null===(e=t.dataTransfer)||void 0===e||e.setData("text/plain",this.dragData)}setDestroyOnDetachFromDOM(t,e){new MutationObserver(((i,s)=>{e.parentElement!==t&&(s.disconnect(),this.destructor())})).observe(t,{childList:!0})}}y.POSITIONS=["absolute","fixed","relative","sticky"];const b={EF:{createElement:t=>document.createElement(t),createElementNS:(t,e)=>document.createElementNS(t,e)},ELLIPSIS:t=>(t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.whiteSpace="nowrap",t),NBSP:" ",NOP:()=>{}};class w{constructor(t,e){this.onUpdateBeingCalled=!1,this.pendingCompose=!1,this.pendingLayout=!1,this.pendingSnapshot=!1;const i=e.ef;this.anchored=!!t.anchor;const s=i.createElement("DIV");this.summaryData=Object.assign(Object.assign({},L.NULLDATA),{label:t.title}),this.title=t.title;const n=new y(i,s,this.title,t.anchor);this.anchored&&e.add(this,n.div),n.div.onmouseenter=this.onFrameEnter.bind(this),n.div.onmouseleave=this.onFrameLeave.bind(this),this.anchored&&t.zoomFactor&&n.popup&&n.popup.setZoomable(this,n.header,Math.min(w.MAX_ZOOMFACTOR,Math.max(0,t.zoomFactor))),n.header.onmouseenter=this.onHeaderEnter.bind(this);const a=new D(i,n.div);this.minimapId=w.idCounter++,this.useWidthToScale=!!t.useWidthToScale,this.verbosity=t.verbosity||0,this.d={clipContextAncestors:new WeakMap,doUpdates:new g(t.debounceMsec||w.DEFAULT_DEBOUNCEMSEC,(()=>this.doPendingUpdates())),onUpdate:t.onUpdate||w.ONUPDATE,paramUpdates:{aggregateLabels:t.aggregateLabels||{},aggregateValuesMap:{},customElementIds:[],dynamicLabels:t.dynamicLabels||[],ef:e.ef,form:t.form,framework:t.framework,snapshotUpcall:{hideDetail:this.snapshotHidden.bind(this),showDetail:this.snapshotActive.bind(this)},snapshotsPanel:a,store:t.store||new o},storeItems:new S};const r=t.usePanelDetail&&e.detail||new f(i);this.z={detail:r,detailPopup:r===e.detail?void 0:this.anchored?n.newDetailPopup(i,r):e.newDetailPopup(r),frame:n,panel:e,pin:new P(i,n.div),snapshotsPanel:a,status:s},s.onmouseover=this.onStatusEnter.bind(this),this.d.paramUpdates.store.notifyMinimapOnUpdate(this,!0),this.d.paramUpdates.form.setLayoutHandler(this)}static ONUPDATE(t){}destructor(){var t;this.detach();const e=this.z;e&&(this.z=void 0,null===(t=e.status.parentElement)||void 0===t||t.removeChild(e.status),e.snapshotsPanel.destructor(),e.pin.destructor(),e.frame.destructor(),e.detail!==e.panel.detail&&e.detail.destructor(),e.detailPopup&&e.detailPopup.destructor(),e.panel.remove(this))}compose(t){this.d&&(this.d.paramUpdates.customElementIds=t||[],this.pendingCompose=this.pendingLayout=!0,this.takeSnapshot())}get isDetached(){return void 0===this.d}get isPinned(){var t;return null===(t=this.z)||void 0===t?void 0:t.pin.isPinned}get isPinnedToPanelDetail(){var t,e;return this.isPinned&&(null===(t=this.z)||void 0===t?void 0:t.detail)===(null===(e=this.z)||void 0===e?void 0:e.panel.detail)}detach(){const t=this.d,e=this.z;t&&e&&(this.d=void 0,t.doUpdates.destructor(),this.pendingCompose=this.pendingLayout=!1,this.pendingSnapshot=!0,this.doPendingUpdates(),e.frame.detach(),t.paramUpdates.form.clearLayoutHandler(),t.paramUpdates.store.notifyMinimapOnUpdate(this,!1),t.storeItems.destructor())}handleLayout(t){var e,i;t&&!(null===(e=this.d)||void 0===e?void 0:e.clipContextAncestors.has(t))||(this.pendingLayout=!0,null===(i=this.d)||void 0===i||i.doUpdates.schedule())}layout(t){const e=this.d,i=this.z;if(!e||!i)return;const s=t&&this.verbosity?Date.now():0,n=e.paramUpdates.form.getRect();if((null==n?void 0:n.height)&&n.width){e.clipContextAncestors=new WeakMap;const s=i.snapshotsPanel.computeScale(n,i.frame,this.useWidthToScale);i.snapshotsPanel.show(!1),e.storeItems.layoutSnapshots(e.clipContextAncestors,n,s),i.snapshotsPanel.show(!0),t&&(i.pin.trackOff(i.frame),i.pin.trackOn(i.snapshotsPanel,t))}t&&this.verbosity&&console.log("FormMinimap["+this.title+"] Layout(ms)="+String(Date.now()-s))}notifyMinimap(t,e){}onFrameEnter(t){const e=this.z;e&&(this.isPinned||e.pin.trackOn(e.snapshotsPanel,t),this.activeSnapshot&&e.detail.setDisplay(this.minimapId,this.activeSnapshot),this.anchored||this.showPopups())}onFrameLeave(){const t=this.z;t&&!this.isPinned&&(t.pin.trackOff(t.frame),t.detail.clear(this.activeSnapshot),t.detailPopup?t.detailPopup.hide():t.panel.hideDetailPopup(),t.frame.popup&&t.frame.popup.hide())}onHeaderEnter(t){t.stopPropagation(),this.z&&!this.isPinned&&(this.activeSnapshot=void 0,this.z.detail.setDisplay(this.minimapId,this.summaryData))}onStatusEnter(t){var e,i;t.stopPropagation(),this.anchored&&!(null===(i=null===(e=this.z)||void 0===e?void 0:e.frame.popup)||void 0===i?void 0:i.isShowing)&&this.showPopups()}takeSnapshot(){return!!this.d&&(this.pendingSnapshot=!0,this.d.doUpdates.schedule(),!0)}doTakeSnapshot(){const t=this.d,e=this.z;if(!t||!e)return{snapshots:[],status:"Disabled",title:this.title};const i=t.paramUpdates,s=Object.values(i.aggregateValuesMap);s.forEach((t=>t.splice(0)));const n=t.storeItems.takeSnapshots(i.form,i.store);s.forEach((t=>t.sort()));const a=e.snapshotsPanel.computeStatus();e.status.className=m.STATUS_CLASS[a];const o={};return"Disabled"!==a&&n.filter((t=>t.error&&t.status===a)).forEach((t=>o[t.aggregateLabel||t.label]=t.error)),this.summaryData.aggregateValues=Object.keys(o).sort().map((t=>t+": "+o[t])),this.summaryData.status=a,{snapshots:n,status:a,title:this.title}}doPendingUpdates(){const t=this.d,e=this.z;if(!t||!e)return;const i=this.verbosity?Date.now():0;this.pendingCompose&&t.storeItems.compose(t.paramUpdates);const s=this.verbosity?Date.now():0;this.pendingLayout&&this.layout();const n=this.verbosity?Date.now():0;let a=n;if(this.pendingSnapshot){const i=this.doTakeSnapshot();e.frame.setSnapshotResult(i),this.verbosity&&(a=Date.now()),e.detail.refreshDisplay(this.minimapId),this.onUpdateBeingCalled||(this.onUpdateBeingCalled=!0,t.onUpdate(i),this.onUpdateBeingCalled=!1)}if(this.verbosity){const t=this.pendingCompose?" Compose(ms)="+String(s-i):"",e=this.pendingLayout?" Layout(ms)="+String(n-s):"",o=this.pendingSnapshot?" Snapshot(ms)="+String(a-n):"";(t||e||o)&&console.log("FormMinimap["+this.title+"]"+t+e+o)}this.pendingCompose=this.pendingLayout=this.pendingSnapshot=!1}showPopups(){const t=this.z;t&&(this.d&&this.d.doUpdates.doNow(),t.frame.popup&&t.frame.popup.show(!0),t.detailPopup?t.detailPopup.show(!1):t.panel.showDetailPopup())}snapshotActive(t){var e;this.isPinned||null===(e=this.z)||void 0===e||e.detail.setDisplay(this.minimapId,this.activeSnapshot=t)}snapshotHidden(t,e){const i=this.z;i&&(this.activeSnapshot===e&&(this.activeSnapshot=void 0),i.detail.clear(e),i.pin.trackOff(i.frame,t))}}w.DEFAULT_DEBOUNCEMSEC=200,w.MAX_ZOOMFACTOR=5,w.idCounter=0;class E{constructor(t,e,i,s){if(this.ef=t,this.vertical=e,this.minimaps=[],i){this.detail=new f(this.ef,s),this.popupParent=i.appendChild(this.ef.createElement("DIV"));this.popupParent.style.position="relative",s||(this.detailPopup=this.newDetailPopup(this.detail)),this.div=i.appendChild(this.ef.createElement("DIV"));const t=this.div.style;t.height=t.width="100%",t.overflowX=e?"hidden":"scroll",t.overflowY=e?"scroll":"hidden",t.whiteSpace=e?"none":"nowrap"}}destructor(){this.detail&&this.detail.destructor(),this.detailPopup&&this.detailPopup.destructor(),this.minimaps.splice(0).forEach((t=>t.destructor()))}add(t,e){e&&this.div&&(this.div.appendChild(e),e.style.height=e.style.width="100%",e.style.display=this.vertical?"block":"inline-block",e.scrollIntoView()),this.minimaps.push(t)}createMinimap(t){const e="FmmMinimap <"+t.title+"> not created: invalid ";if(!t.form)throw new Error(e+"form");return new w(t,this)}destroyDetached(){this.minimaps.filter((t=>t.isDetached)).forEach((t=>t.destructor()))}hideDetailPopup(){this.detailPopup&&!this.minimaps.find((t=>t.isPinnedToPanelDetail))&&this.detailPopup.hide()}newDetailPopup(t){return this.popupParent?new C(this.ef,m.CLASS.DetailPopup,t.e,this.popupParent):void 0}remove(t){const e=this.minimaps.findIndex((e=>e===t));e>=0&&this.minimaps.splice(e,1)}showDetailPopup(){this.detailPopup&&this.detailPopup.show(!1)}}class C{constructor(t,e,i,s){this.div=s.appendChild(t.createElement("DIV")),this.div.className=e,this.div.style.display="none",this.div.style.position="absolute",this.div.appendChild(i),s.style.overflow="visible",i.style.display="block",i.style.position="relative"}destructor(){this.div.parentElement&&this.div.parentElement.removeChild(this.div)}get isShowing(){return"none"!==this.div.style.display}getElementSize(t){const e=this.div.style;if("none"!==e.display){const e=this.div.getBoundingClientRect(),i=t.getBoundingClientRect();return[e.height-(i.top-e.top),e.width-(i.left-e.left)]}e.visibility="hidden",e.display="block";const i=this.div.getBoundingClientRect(),s=t.getBoundingClientRect();return e.display="none",e.visibility="visible",[i.height-(s.top-i.top),i.width-(s.left-i.left)]}hide(){this.div.style.display="none"}setZoomable(t,e,i){let s=!1,n=0,a=0;e.style.cursor="zoom-in",e.onclick=o=>{if(0===o.button){if(o.stopPropagation(),!n){const t=this.div.getBoundingClientRect();n=t.height,a=t.width}t.useWidthToScale?this.div.style.width=String(s?a:a*i)+"px":this.div.style.height=String(s?n:n*i)+"px",t.layout(o),s=!s,e.style.cursor=s?"zoom-out":"zoom-in"}}}show(t){const e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=Math.max(document.documentElement.clientWidth,window.innerWidth||0),s=this.div.style;if("none"!==s.display)return;s.left=s.bottom="auto",s.right=t?"50%":"105%",s.top=t?"50%":"0",s.visibility="hidden",s.display="block";const n=this.div.getBoundingClientRect();if(n.left<0){s.left=t?"50%":"105%",s.right="auto";const e=this.div.getBoundingClientRect();i-e.left-e.width<n.left&&(s.left="auto",s.right=t?"50%":"105%")}if(n.bottom>e){s.bottom=t?"50%":"0",s.top="auto";const i=this.div.getBoundingClientRect();i.top+i.height-e>n.bottom&&(s.bottom="auto",s.top=t?"50%":"0")}s.visibility="visible"}}class P{constructor(t,e){this.SIZE=24,this.parentCursor="none",this.pinned=!1;const i="http://www.w3.org/2000/svg",s=e.appendChild(t.createElementNS(i,"svg"));this.svg=s,e.style.overflow="visible",s.setAttribute("height",String(this.SIZE)),s.setAttribute("width",String(this.SIZE));const n=this.SIZE/4,a=s.appendChild(t.createElementNS(i,"circle"));a.setAttribute("class",m.CLASS.Pushpin),a.setAttribute("cx",String(this.SIZE-n)),a.setAttribute("cy",String(n)),a.setAttribute("r",String(n));const o=s.appendChild(t.createElementNS(i,"polygon"));[[this.SIZE/2+1,Math.ceil(1.5*n)],[0,this.SIZE],[Math.ceil(.6*this.SIZE),2*n-1]].forEach((([t,e])=>{const i=this.svg.createSVGPoint();i.x=t,i.y=e,o.points.appendItem(i)})),o.setAttribute("style","fill:black"),s.style.display="none",s.style.position="absolute"}destructor(){this.trackOff()}get isPinned(){return this.pinned}trackOff(t,e){const i=this.svg.parentNode;e&&e!==i||(this.pinned=!1,this.svg.style.display="none",i.onclick=i.onmousemove=null,i.style.cursor=this.parentCursor,t?t.div.appendChild(this.svg):i.removeChild(this.svg))}trackOn(t,e){const i=this.svg.parentNode,s=i.getBoundingClientRect();i.appendChild(this.svg),this.parentCursor=i.style.cursor,this.svg.style.zIndex=String(+i.style.zIndex+1),i.onclick=e=>{if(0===e.button)if(this.pinned)this.pinned=!1,i.style.cursor="none",i.appendChild(this.svg),this.move(e,s);else{if(this.pinned=!0,i.style.cursor=this.parentCursor,t.reparentPushPinToSnapshot(this.svg,e))return;const n=Math.max(1,100*(e.clientX-s.left)/s.width);this.svg.style.left=String(n)+"%";const a=Math.min(95,100*(s.top+s.height-e.clientY)/s.height);this.svg.style.bottom=String(a)+"%"}},i.onmousemove=t=>this.move(t,s),this.move(e,s),i.style.cursor="none",this.svg.style.display="block"}move(t,e){if(this.pinned)return;const i=t.clientX-e.left,s=e.top+e.height-t.clientY;this.svg.style.left=String(Math.min(e.width,Math.max(i,0)))+"px",this.svg.style.bottom=String(Math.min(e.height,Math.max(s,0)))+"px"}}class L{constructor(t,e){const i=e.aggregateLabels[t];i&&!(t in e.aggregateValuesMap)&&(e.aggregateValuesMap[t]=[]),this.data=Object.assign(Object.assign({},L.NULLDATA),{aggregateLabel:i,aggregateValues:e.aggregateValuesMap[t],name:t}),this.upcall=e.snapshotUpcall,this.div=e.ef.createElement("DIV"),this.div.style.position="absolute",this.div.onmouseover=t=>{t.stopPropagation(),this.upcall.showDetail(this.data)},e.snapshotsPanel.addSnapshot(this,this.div),this.destructor=()=>{this.div.onmouseover=null,this.upcall.hideDetail(this.div,this.data),e.snapshotsPanel.removeSnapshot(this,this.div),this.destructor=b.NOP}}destructor(){}reparentPushPin(t,e,i){const s=this.rect;return!(!s||e<s.left||e>s.left+s.width)&&(!(i<s.top||i>s.top+s.height)&&(this.div.appendChild(t),t.style.left=String(100*(e-s.left)/s.width)+"%",t.style.bottom=String(100*(s.top+s.height-i)/s.height)+"%",!0))}setRect(t){if(this.rect&&t&&this.rect.left===t.left&&this.rect.top===t.top&&this.rect.right===t.right&&this.rect.bottom===t.bottom)return;this.rect=t;const e=this.div.style;return t?(e.left=String(t.left)+"px",e.top=String(t.top)+"px",e.height=String(t.height)+"px",e.width=String(t.width)+"px",e.display="block"):(this.upcall.hideDetail(this.div,this.data),e.display="none")}setStatus(t){this.div.className=m.STATUS_CLASS[this.data.status=t]}}L.NULLDATA={aggregateLabel:"",aggregateValues:void 0,error:"",label:"",name:"",placeholder:"",status:"Optional",value:""};class D{constructor(t,e){this.list=[],this.div=e.appendChild(t.createElement("DIV")),this.div.style.position="relative"}destructor(){this.div.parentElement&&this.div.parentElement.removeChild(this.div),this.list.splice(0).forEach((t=>t.destructor()))}addSnapshot(t,e){this.list.push(t),this.div.appendChild(e)}computeScale(t,e,i){if(!this.div.parentElement)return 0;const[s,n]=e.popup?e.popup.getElementSize(this.div):this.getSize(),a=s/t.height,o=n/t.width,r=this.div.parentElement.style,l=this.div.style;if(i){const e=String(Math.round(t.height*o))+"px";if(r.width=l.width=String(n)+"px",l.height=e,l.height===e)return o}else{const e=String(Math.round(t.width*a))+"px";if(l.height=String(s)+"px",r.width=l.width=e,r.width===e&&l.width===e)return a}const h=Math.min(a,o);return l.height=String(Math.round(t.height*h))+"px",r.width=l.width=String(Math.round(t.width*h))+"px",h}computeStatus(){let t,e,i="Disabled";const s=this.list;for(let n=s.length;--n>=0;){const a=s[n].data.status;if("Invalid"===a)return a;"Disabled"!==a&&(i=void 0),"Required"===a&&(t=a),"Valid"===a&&(e=a)}return t||i||e||"Optional"}removeSnapshot(t,e){const i=this.list.findIndex((e=>e===t));i<0||(this.list.splice(i,1),this.div.removeChild(e))}reparentPushPinToSnapshot(t,e){const i=this.div.getBoundingClientRect(),s=e.clientX-i.left,n=e.clientY-i.top;return!!this.list.find((e=>e.reparentPushPin(t,s,n)))}show(t){this.div.style.display=t?"block":"none"}getSize(){const t=this.div.getBoundingClientRect();if(!this.div.parentElement)return[t.height,t.width];const e=this.div.parentElement.getBoundingClientRect();return[e.height-(t.top-e.top),e.width-(t.left-e.left)]}}t.Fmm=m,t.FmmBootstrap4=s,t.FmmFormHTML=n,t.FmmFrameworkItemHTML=a,t.FmmStoreBase=e,t.FmmStoreHTML=o,t.FmmStoreImpl=class extends e{constructor(t,e){super(),this.values=t,this.errors=e||{},this.values=t||{}}createStoreItem(t,e){for(const s of t.getStoreKeys(e))if(s&&s in this.values)return new i(e,s)}getError(t,e,i){const s=this.errors[e.key];return Array.isArray(s)?s.length?String(s[0]):"":s?String(s):""}getName(t,e){return e.key}getValue(t,e){return this.values[e.key]}isDisabled(t,e){return t.isDisabled(e.e)}update(t,e){this.errors=e||{},this.values=t||{},super.notifyMinimaps()}},Object.defineProperty(t,"__esModule",{value:!0})}));